\begin{figure}[H]
\includegraphics[width=\textwidth]{dmpro/Sketch-2---FPGA-Architecture.png}
\todo{is there an updated version of this image anywhere?}
\todo{ Per Thomas is the one who's been making these. Ask him}
\caption{Processor Architecture}
\label{figure:fpga-architecture}
\end{figure}

The CPU architecture designed for the Barricelli computer is a very clean design, and the key to its high performance lies in its simplicity.
The architecture contains a number of general cores, which in this context are named fitness cores.
The fitness cores are general purpose cores in the sense that they are programmable and turing complete, but for genetic algorithm applications the cores are intended to calculate fitness scores of individuals.

Common genetic algorithms operations are performed by a separate hardware accelerator pipeline.
This accelerator consists of several operation-specific special cores for selection, crossover and mutation.
The fitness cores and the genetic pipeline are all connected to a single data bus.
To avoid any memory synchronization issues the data bus is controlled by a central arbitration unit.

\subsection{Data Memory}

In Barricelli's memory architecture, a central memory controller is responsible for synchronizing memory access on the shared data bus.
Each component that wants to access memory must go through the memory controller, and follow the proper memory access request protocol.
This may introduce a potential bottleneck for memory-bound problems.
Fortunately, genetic algorithms often use only a small amount of data in the ranking of the chromosomes.\cn
This implies that a high number of registers in each core should be sufficient to avoid any memory spill during computation.

In the selection core, on the other hand, the core needs to be able to access the data bus very frequently in order maximize the throughput.
Since the fitness is computationally bound, the data bus is more or less available for the selection core.
This allows the genetic pipeline to compute the chromosomes required for the next step before they are required by the fitness cores. 

\input{fpga/data-memory}

\subsection{Instruction Memory}
\input{fpga/instruction-memory}


\subsection{Rated and Unrated Pools}
\input{fpga/rated-and-unrated-pools}

\subsection{PRNG Module}
\input{fpga/PRNG-module}    
 

\subsection{Fitness Core} \label{fpga:fitness:ss:design_of_the_fitness_core}
    \input{fpga/fitness-core} \label{fpga:subsection:fitness_core}


\subsection{The Genetic Pipeline}
\input{fpga/genetic-pipeline}

\subsection{Parallelism}
The Barricelli is a MIMD computer, which means that it can execute multiple different instruction streams on multiple different data streams simultaneously, in parallel.
The four\cn fitness cores in the archtecture have each their own program counters and may load different data independantly of eachother.
They all share the same data and instruction memory, however, which makes the Barricelli a shared memory model MIMD computer.
Additionally, the genetic pipeline contains multiple specialized cores, which can also execute independant, less general instruction streams on independant data.

