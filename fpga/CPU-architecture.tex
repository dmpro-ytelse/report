\begin{figure}[H]
\includegraphics[width=\textwidth]{fpga/fig/processor_architecture.png}
\caption{Processor Architecture}
\label{figure:fpga-architecture}
\end{figure}

\todo{Modify figure \vref{figure:fpga-architecture} so that it is easy to see that the number of fitness cores is configurable.}

Figure \ref{figure:fpga-architecture} shows the final processor architecture. Most of the figures seen in this picture as for instance "fitness core", are abstractions of more complex logic at lower levels (mostly MSI and LSI components). 
The processor architecture designed for the Barricelli computer is a very clean design, and the key to its high performance lies in its simplicity.
The architecture contains a number of general cores, which in this context are named fitness cores.
The fitness cores are general purpose cores in the sense that they are programmable and Turing complete, but for genetic algorithm applications the cores are intended to calculate fitness scores of individuals.

The number of fitness cores is configurable.
The reference implementation of the Barricelli computer is configured to have 7 fitness cores.

Common genetic algorithms operations are performed by a separate hardware accelerator pipeline.
This accelerator consists of several operation-specific special cores for selection, crossover and mutation.
The fitness cores and the genetic pipeline are all connected to a single data bus.
To avoid any memory synchronization issues the data bus is controlled by a central arbitration unit.

The processor architecture is illustrated in figure \vref{figure:fpga-architecture}.


\subsection{Instruction Memory}
\label{subsec:fpga-instruction-memory}
\input{fpga/instruction-memory}

\subsection{Data Memory}
\label{subsec:fpga-data-memory}
\input{fpga/data-memory}

\subsection{Rated and Unrated Pools}
\input{fpga/rated-and-unrated-pools}

\subsection{PRNG Module}
\input{fpga/PRNG-module}    
 

\subsection{Fitness Core} \label{fpga:fitness:ss:design_of_the_fitness_core}
    \input{fpga/fitness-core} \label{fpga:subsection:fitness_core}


\subsection{The Genetic Pipeline}
\label{fpga:subsection:genetic_pipeline}
\input{fpga/genetic-pipeline}

\subsection{Parallelism}
\todo{awkwardly placed section.. move it somewhere else? like system overview. Yeah, move it to system overview}
The Barricelli is a MIMD computer, which means that it can execute multiple different instruction streams on multiple different data streams simultaneously, in parallel.
The four\cn fitness cores in the architecture have each their own program counters and may load different data independently of each other.
They all share the same data and instruction memory, however, which makes the Barricelli a shared memory model MIMD computer.
Additionally, the genetic pipeline contains multiple specialized cores, which can also execute independent, less general instruction streams on independent data.
